@{
    ViewBag.Title = "Series";
    ViewBag.Section = "Configuración";
    Layout = "~/Views/_Layout.cshtml";
}
@section styles_link {
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.13/css/dataTables.bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.2.4/css/buttons.dataTables.min.css" />
    @Html.StyleLink("css/plugins/chosen/bootstrap-chosen.css")
}

@section scripts_link {
    <script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.13/js/dataTables.bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.2.4/js/dataTables.buttons.min.js"></script>
    @Html.JavaScriptLink("js/plugins/chosen/chosen.jquery.js")
}

@section section_script {
    var table = $('#clientsTable').DataTable();
          table.search( '' ).columns().search( '' ).draw();

          //TEST
          var tiposFac = [
           {"value": 1, "content": "Factura"},
           {"value": 2, "content": "Boleta"},
           {"value": 3, "content": "Nota de debito"}
          ];

          var tiposDoc = [
           {"value": 1, "content": "Factura"},
           {"value": 2, "content": "Boleta"},
           {"value": 3, "content": "Nota de debito"}
          ];

          $('[data-toggle="tooltip"]').tooltip();

          $("#clientsTable_wrapper").children('div').eq(0).addClass("hidden");

          //load_series();
          testing_load();

          $("#defaultCheckbox").change(function(){
            if($(this).is(":checked"))
              $("#default").val("true");
            else
              $("#default").val("false");
          });

          //Creates new Serie
          $("#createSerie").click(function(){
            var jsonSerie = ConvertFormToJSON("#createSerieForm");
            console.log(jsonSerie);
            var jsonSerieArray = [];
            jsonSerieArray.push(jsonSerie);
            add_series(jsonSerieArray);


           /* $.ajax({ method: "POST", url: "#", data: { serie: jsonSerie } })
              .done(function (result) {
                add_series(jsonSerieArray);
              })
              .fail(function (result) {
              });*/
          });

          $("#btnClean").click(function(){
            $("#clientsTable > tbody").empty();
          });

          $("#myBtn").click(function(){
            var json = [{"DocumentType": "FAC 1","InvoiceType": "DOC 1","Id": "SERIE 1","Count": "ACTUAL 1","Default": "true","MinCount": "INICIO 1", "MaxCount": "FIN"}, {"DocumentType": "FAC 2","InvoiceType": "DOC 2","Id": "SERIE 2","Count": "ACTUAL 2","Default": "false","MinCount": "INICIO 1", "MaxCount": "FIN"}, {"DocumentType": "FAC 3","InvoiceType": "DOC 3","Id": "SERIE 3","Count": "ACTUAL 3","Default": "true","MinCount": "INICIO 1", "MaxCount": "FIN"}];
            add_series(json);
          });

          //modificar!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
          function buscarContenido(value, array){
            var returnValue;
            $.each(array, function(i, item) {
              if(value == item.value){
                returnValue = item.content;
              }
            });
            return returnValue;
          }

          function testing_load(){
            var json = [{"DocumentType": "1","InvoiceType": "1","Id": "SERIE 1","Count": "ACTUAL 1","Default": "true","MinCount": "INICIO 1", "MaxCount": "FIN"}, {"DocumentType": "2","InvoiceType": "2","Id": "SERIE 2","Count": "ACTUAL 2","Default": "false","MinCount": "INICIO 1", "MaxCount": "FIN"}, {"DocumentType": "3","InvoiceType": "3","Id": "SERIE 3","Count": "ACTUAL 3","Default": "true","MinCount": "INICIO 1", "MaxCount": "FIN"}];
            add_series(json);
          }

          function add_series(json){
            $.each(json, function (index, value) {
              var billingType = value.DocumentType;
              var type = value.InvoiceType;
              var serie = value.Id;
              var current = value.Count;
              var def = value.Default;
              var start = value.MinCount;
              var end = value.MaxCount;

              //Modificar!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
              var tipoFac = buscarContenido(billingType,tiposFac);
              var tipoDoc = buscarContenido(type,tiposDoc);

              var defaultSymbol = def == "true" ? '<div class="text-center pointerNone"><input type="checkbox" checked="true" disabled></div>' : '<div class="text-center pointerNone"><input type="checkbox" disabled></div>';
              table.row.add( [
                tipoFac,
                tipoDoc,
                serie,
                current,
                defaultSymbol,
                '<td><div class="text-center"><span class="hidden inicioSerie">' + start + '</span><span class="hidden finSerie">' + end + '</span><button class="btn btn-info btn-xs showSerie actionBtn" data-toggle="modal" href="modal-form" data-target="#modalEditar" type="button" data-toggle="tooltip" data-placement="top" title="Ver"><i class="fa fa-search"></i></button><button class="btn btn-warning btn-xs editSerie actionBtn" data-toggle="modal" href="modal-form" data-target="#modalEditar" type="button" data-toggle="tooltip" data-placement="top" title="Editar"><i class="fa fa-pencil"></i></button><button class="btn btn-danger btn-xs deleteSerie actionBtn" type="button" data-toggle="tooltip" data-placement="top" title="Eliminar"><i class="fa fa-trash"></i></button></div></td>'
              ] ).draw(false);

            });
          }

          //Load all data into the table
          function load_series(){
            $.ajax({ method: "GET", url: "#", data: {} })
              .done(function (result) {
                var objResult = jQuery.parseJSON(result);
                if (!jQuery.isEmptyObject(objResult)) {
                  add_series(objResult);
                }
              })
              .fail(function (result) {
            });
          }
}

<div id="deleteAlert" class="alert alert-danger alert-dismissable hidden" style="margin-top: 10px;">
    <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
    <span>No se puede eliminar una serie que esté en uso</span>
</div>

    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>Tabla de Series</h5>
                    <div class="ibox-tools">
                        <a>
                            <a class="btn btn-primary" data-toggle="modal" href="modal-form" data-target="#modalInsert">Agregar nueva serie</a>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="table-responsive">


                        <table id="clientsTable" class="table table-striped table-bordered table-hover dataTables-example">
                            <thead>
                                <tr>
                                    <th>Tipo de Facturacion</th>
                                    <th>Tipo de Documento</th>
                                    <th>Serie</th>
                                    <th>Actual</th>
                                    <th>Default</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
